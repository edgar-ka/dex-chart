# dex-app-k8s

## What's inside
Helm chart to deploy sample application.
Deployment consists of PostgreSQL primary database, read replica(s), application container(s), and ingress rules.

## What's not inside
* Autoscaling. Left for the next exercise.
* Automated deployment testing.
* Setting database passwords explicitly. All is autogenerated.
* Helm chart repo creation/management.

## How to use

### Configuration

Override any parameters in new YAML file, for example, `myvalues.yml`

Configurable parameters:

| Variable | Description | Default value |
|----------|-------------|---------------|
| service.type | Type of app service | "ClusterIP" |
| service.port | Port number for app service | 80 |
| postgresql.imageTag | Override tag for DB containers | "14.4.0-debian-11-r9" |
| postgresql.readReplicaCount | Database read replicas count | 1 |
| postgresql.user | Custom database user | "flask" |
| postgresql.database | Database to create | "flask_db" |
| postgresql.replicationUser | Replication user | "repl_user" |
| postgresql.resources | Resources for database pods | {"limits": {}, "requests": {"cpu": "250m", "memory": "256Mi"}} |
| application.replicaCountRO | Number of "read" pods | 2 |
| application.replicaCountRW | Number of "write" pods | 1 |
| application.image.repository | Repository for app images | "docker.io/edgarka/dexapp" |
| application.image.pullPolicy | App image pull policy | "IfNotPresent" |
| application.image.tag | Overrides the image tag whose default is the chart `appVersion` | "" |
| application.resources | Resources for application pods | {"limits": {}, "requests": {"cpu": "250m", "memory": "256Mi"}} |
| serviceAccount.create | Specifies whether a service account should be created | true |
| serviceAccount.annotations | Annotations to add to the service account | {} |
| serviceAccount.name | The name of the service account to use. Autogenerated if not set. | "" |
| ingress.enabled | Whether Ingress is enabled | true |
| ingress.className | Corresponds to ingress controller installed in the cluster | "nginx" |
| ingress.annotations | Annotations to add to Ingress | {"kubernetes.io/tls-acme": "false"} |
| ingress.host | Host to include in ingress rules | "localhost" |
| ingress.tls | TLS configuration | [] |

### Installation

```bash
git clone https://github.com/edgar-ka/dex-chart.git
helm install -t myvalues.yml mytestapp dex-chart/dex-app-k8s
```

